<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_buzzer_8cpp_source" xml:lang="zh">
<title>buzzer.cpp</title>
<indexterm><primary>HW-Components/devices/buzzer/src/buzzer.cpp</primary></indexterm>
浏览该文件的文档.<programlisting linenumbering="unnumbered"><anchor xml:id="_buzzer_8cpp_source_1l00001"/>00001 
<anchor xml:id="_buzzer_8cpp_source_1l00016"/>00016 <emphasis role="comment">/*&#32;Includes&#32;------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00017"/>00017 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_buzzer_8hpp">buzzer.hpp</link>&quot;</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00018"/>00018 
<anchor xml:id="_buzzer_8cpp_source_1l00019"/>00019 <emphasis role="preprocessor">#include&#32;&lt;cmath&gt;</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00020"/>00020 
<anchor xml:id="_buzzer_8cpp_source_1l00021"/>00021 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_assert_8hpp">assert.hpp</link>&quot;</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00022"/>00022 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_base_8hpp">base.hpp</link>&quot;</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00023"/>00023 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_tick_8hpp">tick.hpp</link>&quot;</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00024"/>00024 
<anchor xml:id="_buzzer_8cpp_source_1l00025"/>00025 <emphasis role="keyword">namespace&#32;</emphasis><link linkend="_namespacehello__world">hello_world</link>
<anchor xml:id="_buzzer_8cpp_source_1l00026"/>00026 {
<anchor xml:id="_buzzer_8cpp_source_1l00027"/>00027 <emphasis role="keyword">namespace&#32;</emphasis>devices
<anchor xml:id="_buzzer_8cpp_source_1l00028"/>00028 {
<anchor xml:id="_buzzer_8cpp_source_1l00029"/>00029 <emphasis role="keyword">namespace&#32;</emphasis>buzzer
<anchor xml:id="_buzzer_8cpp_source_1l00030"/>00030 {
<anchor xml:id="_buzzer_8cpp_source_1l00031"/>00031 <emphasis role="comment">/*&#32;Private&#32;macro&#32;-------------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00032"/>00032 <emphasis role="comment">/*&#32;Private&#32;constants&#32;---------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00033"/>00033 
<anchor xml:id="_buzzer_8cpp_source_1l00034"/><link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a3c9fc26c3cdc343d34458d093dd3cc5f">00034</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a3c9fc26c3cdc343d34458d093dd3cc5f">kTimerFreq</link>&#32;=&#32;1e6f;
<anchor xml:id="_buzzer_8cpp_source_1l00035"/><link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a482cb003f98ad42ba36d039c6c2a1317">00035</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">float</emphasis>&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a482cb003f98ad42ba36d039c6c2a1317">kMaxDuty</link>&#32;=&#32;0.5f;&#32;&#32;
<anchor xml:id="_buzzer_8cpp_source_1l00036"/>00036 <emphasis role="comment">/*&#32;Private&#32;types&#32;-------------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00037"/>00037 <emphasis role="comment">/*&#32;Private&#32;variables&#32;---------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00038"/>00038 <emphasis role="comment">/*&#32;External&#32;variables&#32;--------------------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00039"/>00039 <emphasis role="comment">/*&#32;Private&#32;function&#32;prototypes&#32;-----------------------------------------------*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00040"/>00040 
<anchor xml:id="_buzzer_8cpp_source_1l00051"/><link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a9901a266077ad9867ddad94ecab40d2d">00051</link> <link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a9901a266077ad9867ddad94ecab40d2d">Buzzer::Buzzer</link>(TIM_HandleTypeDef&#32;*htim,&#32;uint32_t&#32;channel,
<anchor xml:id="_buzzer_8cpp_source_1l00052"/>00052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9">PlayConfig</link>&#32;play_config,&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info">TuneListInfo</link>&#32;*kTuneListInfoPtr)
<anchor xml:id="_buzzer_8cpp_source_1l00053"/>00053 &#32;&#32;&#32;&#32;:&#32;kHtim_(htim),&#32;kChannel_(channel),&#32;play_config_(play_config)
<anchor xml:id="_buzzer_8cpp_source_1l00054"/>00054 {
<anchor xml:id="_buzzer_8cpp_source_1l00055"/>00055 &#32;&#32;<emphasis role="comment">/*&#32;变量检查&#32;*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00056"/>00056 <emphasis role="preprocessor">#pragma&#32;region</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00057"/>00057 &#32;&#32;<link linkend="_assert_8hpp_1a5969df827ceb603bed14c4106586484a">HW_ASSERT</link>(IS_TIM_INSTANCE(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>-&gt;Instance),&#32;<emphasis role="stringliteral">&quot;Error&#32;TIM&#32;handle&quot;</emphasis>);
<anchor xml:id="_buzzer_8cpp_source_1l00058"/>00058 &#32;&#32;<link linkend="_assert_8hpp_1a5969df827ceb603bed14c4106586484a">HW_ASSERT</link>(IS_TIM_CHANNELS(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a15bb4ff8e5ba9bc2d340063ba0058bb7">kChannel_</link>),&#32;<emphasis role="stringliteral">&quot;Error&#32;TIM&#32;channel:&#32;%d&quot;</emphasis>,&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a15bb4ff8e5ba9bc2d340063ba0058bb7">kChannel_</link>);
<anchor xml:id="_buzzer_8cpp_source_1l00059"/>00059 &#32;&#32;<link linkend="_assert_8hpp_1a5969df827ceb603bed14c4106586484a">HW_ASSERT</link>(play_config&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9a4e59bb85f2a47ce95c7c5868775d9348">kPlayConfigLoopPlayback</link>&#32;||
<anchor xml:id="_buzzer_8cpp_source_1l00060"/>00060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;play_config&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9a7c37348a5faa1a2dc387e5376e22f992">kPlayConfigSinglePlayback</link>,
<anchor xml:id="_buzzer_8cpp_source_1l00061"/>00061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;Error&#32;play&#32;config:&#32;%d&quot;</emphasis>,&#32;tune_list_info.play_config);
<anchor xml:id="_buzzer_8cpp_source_1l00062"/>00062 <emphasis role="preprocessor">#pragma&#32;endregion</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00063"/>00063 
<anchor xml:id="_buzzer_8cpp_source_1l00064"/>00064 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a67595f4b9558ce6320b85f9c580f7b95">setNewTune</link>(kTuneListInfoPtr);
<anchor xml:id="_buzzer_8cpp_source_1l00065"/>00065 }
<anchor xml:id="_buzzer_8cpp_source_1l00066"/>00066 
<anchor xml:id="_buzzer_8cpp_source_1l00067"/><link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a4186105c4e8cedc66d9363698c2e0e9b">00067</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a4186105c4e8cedc66d9363698c2e0e9b">Buzzer::set_play_config</link>(<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9">PlayConfig</link>&#32;play_config)
<anchor xml:id="_buzzer_8cpp_source_1l00068"/>00068 {
<anchor xml:id="_buzzer_8cpp_source_1l00069"/>00069 <emphasis role="comment">/*&#32;变量检查&#32;*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00070"/>00070 <emphasis role="preprocessor">#pragma&#32;region</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00071"/>00071 &#32;&#32;<link linkend="_assert_8hpp_1a5969df827ceb603bed14c4106586484a">HW_ASSERT</link>(play_config&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9a4e59bb85f2a47ce95c7c5868775d9348">kPlayConfigLoopPlayback</link>&#32;||
<anchor xml:id="_buzzer_8cpp_source_1l00072"/>00072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;play_config&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9a7c37348a5faa1a2dc387e5376e22f992">kPlayConfigSinglePlayback</link>,
<anchor xml:id="_buzzer_8cpp_source_1l00073"/>00073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;Error&#32;play&#32;config:&#32;%d&quot;</emphasis>,&#32;tune_list_info.play_config);
<anchor xml:id="_buzzer_8cpp_source_1l00074"/>00074 <emphasis role="preprocessor">#pragma&#32;endregion</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00075"/>00075 
<anchor xml:id="_buzzer_8cpp_source_1l00076"/>00076 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a552e1698456e2a148072f21ed59abaaa">play_config_</link>&#32;=&#32;play_config;
<anchor xml:id="_buzzer_8cpp_source_1l00077"/>00077 }
<anchor xml:id="_buzzer_8cpp_source_1l00078"/>00078 
<anchor xml:id="_buzzer_8cpp_source_1l00087"/><link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a67595f4b9558ce6320b85f9c580f7b95">00087</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a67595f4b9558ce6320b85f9c580f7b95">Buzzer::setNewTune</link>(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info">TuneListInfo</link>&#32;*kTuneListInfoPtr)
<anchor xml:id="_buzzer_8cpp_source_1l00088"/>00088 {
<anchor xml:id="_buzzer_8cpp_source_1l00089"/>00089 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>&#32;=&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00090"/>00090 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4775b8ae94a043ac58824f4ebb4be37">tune_start_tick_</link>&#32;=&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00091"/>00091 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00092"/>00092 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00093"/>00093 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ad0d5171f1e0990b68bfbc4392d73d7b3">last_is_playing_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00094"/>00094 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1abcbd00189b50b82539d9b86d97694ad6">kTuneListInfoPtr_</link>&#32;=&#32;kTuneListInfoPtr;
<anchor xml:id="_buzzer_8cpp_source_1l00095"/>00095 
<anchor xml:id="_buzzer_8cpp_source_1l00096"/>00096 &#32;&#32;__HAL_TIM_SET_AUTORELOAD(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>,&#32;0);
<anchor xml:id="_buzzer_8cpp_source_1l00097"/>00097 &#32;&#32;__HAL_TIM_SET_COMPARE(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>,&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a15bb4ff8e5ba9bc2d340063ba0058bb7">kChannel_</link>,&#32;0);
<anchor xml:id="_buzzer_8cpp_source_1l00098"/>00098 &#32;&#32;HAL_TIM_PWM_Start(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>,&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a15bb4ff8e5ba9bc2d340063ba0058bb7">kChannel_</link>);
<anchor xml:id="_buzzer_8cpp_source_1l00099"/>00099 }
<anchor xml:id="_buzzer_8cpp_source_1l00100"/>00100 
<anchor xml:id="_buzzer_8cpp_source_1l00106"/><link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4a10c92796395a9b6c229f0bfec9cdb">00106</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4a10c92796395a9b6c229f0bfec9cdb">Buzzer::play</link>()
<anchor xml:id="_buzzer_8cpp_source_1l00107"/>00107 {
<anchor xml:id="_buzzer_8cpp_source_1l00108"/>00108 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00109"/>00109 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00110"/>00110 &#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00111"/>00111 
<anchor xml:id="_buzzer_8cpp_source_1l00112"/>00112 &#32;&#32;uint32_t&#32;tick&#32;=&#32;<link linkend="_namespacehello__world_1_1dsp_1_1tick_1a97910b07255da1979f8ceafd8c6d2ea5">dsp::tick::GetTickMs</link>();
<anchor xml:id="_buzzer_8cpp_source_1l00113"/>00113 
<anchor xml:id="_buzzer_8cpp_source_1l00114"/>00114 &#32;&#32;<emphasis role="comment">/*&#32;播放结束处理&#32;*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00115"/>00115 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1abcbd00189b50b82539d9b86d97694ad6">kTuneListInfoPtr_</link>-&gt;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info_1a0aefddbb58c23c7d906baf5bce59a4bf">list</link>[<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>]&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a0db5beb79cee27259eaefb4a2a04126da6944bb0666e55eb573bc605afeff6695">kTuneEnd</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00116"/>00116 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a552e1698456e2a148072f21ed59abaaa">play_config_</link>&#32;==&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a2e5d78b68fcdefd56e87870dfb59b4d9a4e59bb85f2a47ce95c7c5868775d9348">kPlayConfigLoopPlayback</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00117"/>00117 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00118"/>00118 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>&#32;=&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00119"/>00119 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00120"/>00120 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>&#32;=&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ad0d5171f1e0990b68bfbc4392d73d7b3">last_is_playing_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00121"/>00121 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00122"/>00122 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>&#32;=&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00123"/>00123 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab2c457527b41d290e2e68101c508b73a">mute</link>();
<anchor xml:id="_buzzer_8cpp_source_1l00124"/>00124 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00125"/>00125 &#32;&#32;&#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00126"/>00126 &#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00127"/>00127 
<anchor xml:id="_buzzer_8cpp_source_1l00128"/>00128 &#32;&#32;<emphasis role="comment">/*&#32;切换音符&#32;*/</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00129"/>00129 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00130"/>00130 &#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00131"/>00131 &#32;&#32;&#32;&#32;uint32_t&#32;auto_reload&#32;=&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a4098153da83266e584a961b94e2213c4">tune2AutoReload</link>(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1abcbd00189b50b82539d9b86d97694ad6">kTuneListInfoPtr_</link>-&gt;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info_1a0aefddbb58c23c7d906baf5bce59a4bf">list</link>[<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>]);
<anchor xml:id="_buzzer_8cpp_source_1l00132"/>00132 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;intensity_scale&#32;=
<anchor xml:id="_buzzer_8cpp_source_1l00133"/>00133 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_namespacehello__world_1a34cb06299a34f746d556d23dc16904aa">hello_world::Bound</link>(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1abcbd00189b50b82539d9b86d97694ad6">kTuneListInfoPtr_</link>-&gt;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info_1a4cb3c97639dfe61c0729c40b80380fa1">intensity_scale</link>,&#32;0,&#32;1);
<anchor xml:id="_buzzer_8cpp_source_1l00134"/>00134 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">float</emphasis>&#32;duty&#32;=&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a482cb003f98ad42ba36d039c6c2a1317">kMaxDuty</link>&#32;*&#32;intensity_scale;
<anchor xml:id="_buzzer_8cpp_source_1l00135"/>00135 &#32;&#32;&#32;&#32;__HAL_TIM_SET_AUTORELOAD(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>,&#32;auto_reload);
<anchor xml:id="_buzzer_8cpp_source_1l00136"/>00136 &#32;&#32;&#32;&#32;__HAL_TIM_SET_COMPARE(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b838c1b98dc600c53705e9fe04d99a4">kHtim_</link>,&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a15bb4ff8e5ba9bc2d340063ba0058bb7">kChannel_</link>,&#32;auto_reload&#32;*&#32;duty);
<anchor xml:id="_buzzer_8cpp_source_1l00137"/>00137 &#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00138"/>00138 
<anchor xml:id="_buzzer_8cpp_source_1l00139"/>00139 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ad0d5171f1e0990b68bfbc4392d73d7b3">last_is_playing_</link>&#32;&amp;&amp;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>)&#32;{&#32;&#32;<emphasis role="comment">//&#32;刚开始播放</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00140"/>00140 &#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4775b8ae94a043ac58824f4ebb4be37">tune_start_tick_</link>&#32;=&#32;tick;
<anchor xml:id="_buzzer_8cpp_source_1l00141"/>00141 &#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tick&#32;-&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4775b8ae94a043ac58824f4ebb4be37">tune_start_tick_</link>&#32;&gt;=&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1abcbd00189b50b82539d9b86d97694ad6">kTuneListInfoPtr_</link>-&gt;<link linkend="_structhello__world_1_1devices_1_1buzzer_1_1_tune_list_info_1abfacb236c2a5ef6dc1499c96af943738">tune_duration</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00142"/>00142 &#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab4775b8ae94a043ac58824f4ebb4be37">tune_start_tick_</link>&#32;=&#32;tick;
<anchor xml:id="_buzzer_8cpp_source_1l00143"/>00143 &#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>++;
<anchor xml:id="_buzzer_8cpp_source_1l00144"/>00144 
<anchor xml:id="_buzzer_8cpp_source_1l00145"/>00145 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>&#32;&gt;=&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a0beaff31c15a2e1e53c17cba47b8111b">kTuneListMaxLen</link>)&#32;{&#32;&#32;<emphasis role="comment">//&#32;音符溢出处理</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00146"/>00146 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>&#32;=&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ad0d5171f1e0990b68bfbc4392d73d7b3">last_is_playing_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00147"/>00147 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">false</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00148"/>00148 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a3b93cc23f3be6bb791b9a0ca9dacad39">tune_idx_</link>&#32;=&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00149"/>00149 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ab2c457527b41d290e2e68101c508b73a">mute</link>();
<anchor xml:id="_buzzer_8cpp_source_1l00150"/>00150 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00151"/>00151 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00152"/>00152 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a8947005e9e7acd2250aec39402bdb9e9">tune_switch_</link>&#32;=&#32;<emphasis role="keyword">true</emphasis>;
<anchor xml:id="_buzzer_8cpp_source_1l00153"/>00153 &#32;&#32;&#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00154"/>00154 &#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00155"/>00155 
<anchor xml:id="_buzzer_8cpp_source_1l00156"/>00156 &#32;&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ad0d5171f1e0990b68bfbc4392d73d7b3">last_is_playing_</link>&#32;=&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1ade3f992137ca255598cda0947b55f778">is_playing_</link>;
<anchor xml:id="_buzzer_8cpp_source_1l00157"/>00157 }
<anchor xml:id="_buzzer_8cpp_source_1l00158"/>00158 
<anchor xml:id="_buzzer_8cpp_source_1l00165"/><link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a4098153da83266e584a961b94e2213c4">00165</link> uint32_t&#32;<link linkend="_classhello__world_1_1devices_1_1buzzer_1_1_buzzer_1a4098153da83266e584a961b94e2213c4">Buzzer::tune2AutoReload</link>(<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a0db5beb79cee27259eaefb4a2a04126d">Tune</link>&#32;tune)<emphasis role="keyword">&#32;const</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00166"/>00166 <emphasis role="keyword"></emphasis>{
<anchor xml:id="_buzzer_8cpp_source_1l00167"/>00167 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tune&#32;&lt;&#32;kTuneC3&#32;||&#32;tune&#32;&gt;=&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a0db5beb79cee27259eaefb4a2a04126daf58609de52719ad2c93932ad4e3272c5">kTuneRst</link>)&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00168"/>00168 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_buzzer_8cpp_source_1l00169"/>00169 &#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_buzzer_8cpp_source_1l00170"/>00170 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keyword">static_cast&lt;</emphasis>uint32_t<emphasis role="keyword">&gt;</emphasis>(
<anchor xml:id="_buzzer_8cpp_source_1l00171"/>00171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;440&#32;*&#32;2^((n-69)/12)&#32;Hz</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00172"/>00172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_namespacehello__world_1_1devices_1_1buzzer_1a3c9fc26c3cdc343d34458d093dd3cc5f">kTimerFreq</link>&#32;/&#32;440.0f&#32;*&#32;powf(1.05946f,&#32;(tune)-69)&#32;-&#32;1);
<anchor xml:id="_buzzer_8cpp_source_1l00173"/>00173 &#32;&#32;}
<anchor xml:id="_buzzer_8cpp_source_1l00174"/>00174 }
<anchor xml:id="_buzzer_8cpp_source_1l00175"/>00175 }&#32;&#32;<emphasis role="comment">//&#32;namespace&#32;buzzer</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00176"/>00176 }&#32;&#32;<emphasis role="comment">//&#32;namespace&#32;devices</emphasis>
<anchor xml:id="_buzzer_8cpp_source_1l00177"/>00177 }&#32;&#32;<emphasis role="comment">//&#32;namespace&#32;hello_world</emphasis>
</programlisting></section>
